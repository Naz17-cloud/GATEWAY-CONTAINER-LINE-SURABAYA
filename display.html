<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Display QR Code</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      font-family: 'Georgia', serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
      text-align: center;
      position: relative;
    }

    /* Animasi fade-in untuk Welcome */
    .welcome {
      font-size: 48px;
      font-weight: bold;
      color: #FFD700;
      margin-top: 40px;
      opacity: 0;
      animation: fadeIn 3s ease forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .title {
      font-size: 38px;
      font-style: italic;
      color: #58caed;
      margin-top: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }

    .company {
      font-size: 44px;
      color: #98c732;
      margin-top: 60px;
      font-weight: bold;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
    }

    .table-box {
      margin-top: 20px;
      padding: 40px;
      border: 5px solid gold;
      border-radius: 20px;
      background: rgba(0,0,0,0.6);
      box-shadow: 0 0 15px rgba(255,215,0,0.7);
      min-width: 280px;
    }

    .table-text {
      font-size: 28px;
      margin-bottom: 10px;
      color: white;
    }

    .table-number {
      font-size: 90px;
      font-weight: bold;
      color: #FFD700;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.7);
    }

    .watermark {
      position: absolute;
      bottom: 20px;
      font-size: 20px;
      color: white;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="welcome">
    SELAMAT DATANG DI CUSTOMER GATHERING <br>
    GATEWAY CONTAINER LINE SURABAYA 2025
  </div>

  <div class="title">
    "Navigating The Turbulence, Cruising The Opportunities"
  </div>

  <div class="company" id="company">Nama Perusahaan</div>

  <div class="table-box">
    <div class="table-text">Nomor Meja</div>
    <div class="table-number" id="table-number">--</div>
  </div>

  <div class="watermark">Tim Bjir</div>

  <script>
    // --- UTIL: Ambil parameter dari URL halaman (jika dibuka via link dengan query) ---
    function getQueryParamsFromLocation() {
      try {
        const urlParams = new URLSearchParams(window.location.search || "");
        return {
          company: (urlParams.get("company") || "Nama Perusahaan").toString(),
          table: (urlParams.get("table") || "--").toString()
        };
      } catch {
        return { company: "Nama Perusahaan", table: "--" };
      }
    }

    // --- UTIL: Parsing string hasil scan jadi {company, table} yang aman ---
    function parseScanToParams(data) {
      // Normalisasi: trim & buang karakter kontrol
      const raw = (data || "").replace(/\s+$/g, "").trim();
      if (!raw) return null;

      let qs = "";

      // Kasus 1: URL lengkap -> ambil .search
      try {
        // Tambah protokol jika perlu agar URL() tidak error
        const maybeUrl = raw.match(/^[a-zA-Z]+:\/\//) ? raw : ("http://" + raw);
        const u = new URL(maybeUrl);
        qs = u.search || "";
      } catch {
        // Bukan URL valid
      }

      // Kasus 2: ada tanda ? langsung
      if (!qs && raw.includes("?")) {
        qs = raw.slice(raw.indexOf("?"));
      }

      // Kasus 3: sudah berupa query string saja (mengandung '=')
      if (!qs && raw.includes("=")) {
        qs = "?" + raw;
      }

      // Jika sudah punya query string -> pakai URLSearchParams
      if (qs) {
        const usp = new URLSearchParams(qs.startsWith("?") ? qs.slice(1) : qs);
        const company = usp.get("company");
        const table = usp.get("table");
        if (company || table) {
          return {
            company: (company || "TIDAK DIKENAL").toString(),
            table: (table || "--").toString()
          };
        }
      }

      // Kasus 4: kalau ternyata hanya angka -> anggap itu nomor meja
      if (/^\d{1,4}$/.test(raw)) {
        return { company: "TIDAK DIKENAL", table: raw };
      }

      // Kasus 5: fallback: format "NAMA|MEJA" atau "NAMA,MEJA"
      const parts = raw.split(/[|,;]\s*/);
      if (parts.length >= 2 && /^\d{1,4}$/.test(parts[1])) {
        return { company: parts[0], table: parts[1] };
      }

      // Gagal parse
      return null;
    }

    // --- Update tampilan (aman terhadap null element) ---
    function updateDisplay(params) {
      const companyEl = document.getElementById("company");
      const tableEl = document.getElementById("table-number");
      if (companyEl && params.company) companyEl.textContent = params.company.toUpperCase();
      if (tableEl && params.table)  tableEl.textContent = params.table;
    }

    // --- INIT: set dari URL saat load ---
    document.addEventListener("DOMContentLoaded", () => {
      updateDisplay(getQueryParamsFromLocation());

      // Mode Scanner: tangkap ketikan scanner (keyboard wedge)
      let buffer = "";
      const allowed = /[0-9A-Za-zÀ-ž .,_\-@#:/?&=%+]/; // karakter umum URL/teks

      document.addEventListener("keydown", (e) => {
        // Enter = akhir scan
        if (e.key === "Enter") {
          const parsed = parseScanToParams(buffer);
          buffer = "";
          if (parsed) updateDisplay(parsed);
          return;
        }

        // Backspace: hapus 1 char dari buffer
        if (e.key === "Backspace") {
          buffer = buffer.slice(0, -1);
          return;
        }

        // Abaikan tombol kontrol (Shift/Alt/Ctrl/Arrow/Function dll)
        if (e.key.length !== 1) return;

        // Hanya terima karakter yang umum
        if (allowed.test(e.key)) buffer += e.key;
      });

      // Mode Paste: beberapa scanner melakukan paste + Enter
      document.addEventListener("paste", (e) => {
        const text = (e.clipboardData || window.clipboardData).getData("text");
        const parsed = parseScanToParams(text);
        if (parsed) updateDisplay(parsed);
      });
    });
  </script>
</body>
</html>
